# Results

## Fetal Deaths Over Years
```{r}
library(ggplot2)
library(dplyr)
library(plotly)

### Total
g1 <- fetal %>%
  dplyr::group_by(Year) %>%
  dplyr::summarise(add = sum(Fetal.Deaths), add_p = sum(Percent.of.Total.Deaths)) %>%
  ggplot(aes(x = Year, y = add_p)) +
  geom_line() +
  geom_point(alpha = 0.5) +
  geom_point(aes(x = 2007, y = 7.22), color = "red") +
  geom_text(aes(label = add_p), nudge_x = 0.4, nudge_y = -0.06, size = 3) +
  labs(x = "Year", y = "Total Fetal Death Rate",
       title = "Fetal Death Rate Over Years") +
  scale_x_continuous(breaks = seq(2005, 2019, 1))
g1


g2 <- fetal %>%
  dplyr::group_by(Sex, Year) %>%
  dplyr::summarise(add_g = sum(Fetal.Deaths), add_g_p = sum(Percent.of.Total.Deaths)) %>%
  ggplot(aes(x = Year, y = add_g_p, col = Sex)) +
  geom_line() +
  geom_point(alpha = 0.5) +
  labs(x = "Year", y = "Fetal Death Rate",
       title = "Fetal Death Rate by Different Genders Over Years") +
  scale_x_continuous(breaks = seq(2005, 2019, 1))

start = 2007
end = 2008
g2 + annotate("rect", xmin = start, xmax = end, ymin = -Inf, ymax = Inf, 
              fill = "green", alpha = .2) +
  annotate("text", x = 2008.1, y = 3, label = "2007-2008", 
           color = "black", hjust = 0) +
  theme_classic()

# g3 <- birth_s_g %>%
#   group_by(Gender, Year) %>%
#   summarise(sum = sum(Births)) %>%
#   ggplot(aes(x = Year, y = sum, col = Gender)) +
#   geom_line() +
#   geom_point() +
#   labs(x = "Year", y = "Number of Births", 
#        title = "Number of Births by Different Genders Over Years") +
#   theme_classic() +
#   scale_x_continuous(breaks = seq(2007, 2019, 1))
# g3

# fetal %>%
#   group_by(Year) %>%
#   summarise(add = sum(Fetal.Deaths), add_p = sum(Percent.of.Total.Deaths)) %>%
#   plot_ly(x = ~Year, y = ~add, type = "scatter", mode = "lines+markers",
#           hoverinfo = "text", text = ~add) %>%
#   layout(title = "Total Fetal Deaths Over Years", 
#          xaxis = list(title = "Year", breaks = seq(2005, 2019, 1)),
#          yaxis = list(title = "Number of Total Death"))
```

First of all, let us take a look at how the fetal death rates changed between 2005 and 2019. We can clearly see a decreasing trend since 2007. Since we donâ€™t have data before 2007, even though our graphs show there might be an increasing trend before 2007, we cannot simply make a conclusion. After further checking the movement by splitting the data into different genders, we found out that from 2007 to 2008, the female fetal death rate had a sharper decrease than male data did. We should notice that our graph shows higher death rates for male fetuses. This is not because male fetuses have a higher possibility of death but because male fetuses have higher birth rates in general. This decreasing trend is a good indicator, showing an improvement in national health. It is also unsurprising: with the development of technology and medical skills, we can now detect any potential factors that lead to fetus deaths more efficiently.

## Geographical Distribution
```{r}
#install.packages("rgdal",dependencies = TRUE)
library(choroplethrMaps)
library(choroplethr)
df_geo <- fetal_2 %>%
  dplyr::group_by(Standard.Residence.States) %>%
  dplyr::summarise(death = sum(Fetal.Deaths), death.p = sum(Percent.of.Total.Deaths)) %>%
  as.data.frame() %>%
  transmute(region = tolower(`Standard.Residence.States`), value = death.p)

state_choropleth(df_geo, title = "Contribution of Fetal Death to Total Death in US",
                 legend = "Percentage")
```


## Remarkable Fetal Characteristics

### Does Infant Weights matters?
```{r}
library(forcats)
fetal_2 %>% 
  na.omit() %>%
  dplyr::group_by(Infant.Delivery.Weight.14) %>%
  dplyr::summarise(add = sum(Percent.of.Total.Deaths)) %>%
  dplyr::arrange(add) %>%
  ggplot2::ggplot(aes(x = add, y = forcats::fct_reorder(Infant.Delivery.Weight.14,add))) +
  ggplot2::geom_point(color = "blue") +
  ggplot2::theme_linedraw() +
  ggplot2::ylab("Percent") +
  ggplot2::xlab("Infant Weight") +
  ggplot2::ggtitle("Percent of Total Deaths for Different Infant Weights")
```

### Relationships between delivery method and plurality of birth
```{r}
library(parcoords)
library(GGally)
library(ggalluvial)
df_alluvial <- fetal_2 %>%
  dplyr::group_by(Delivery.Method, Plurality.or.Multiple.Birth) %>%
  dplyr::summarise(total = sum(Percent.of.Total.Deaths)) %>%
  na.omit() 
ggplot(df_alluvial, aes(axis1 = Delivery.Method, axis2 = Plurality.or.Multiple.Birth, 
                        y = total)) +
  geom_alluvium(color = "black" ) +
  geom_stratum() +
  geom_text(stat = "stratum", aes(label = paste(after_stat(stratum)))) +
  scale_x_discrete(limits = c("Delivery Method","Multiple Birth")) +
  ylab("Percentage to Total Death") +
  ggtitle("Flow of change between delivery method and plurality of birth")
```

```{r}
df_mosaic <- fetal_2 %>%
  dplyr::group_by(Delivery.Method,Plurality.or.Multiple.Birth) %>%
  dplyr::summarise(add = sum(Percent.of.Total.Deaths)) %>%
  na.omit()

df_mosaic$Plurality.or.Multiple.Birth <- factor(df_mosaic$Plurality.or.Multiple.Birth,
                                             levels = c("Single","Twin","Triplet"))
  

tab_mosaic <- xtabs(add~.,df_mosaic)

vcd::mosaic(Delivery.Method~Plurality.or.Multiple.Birth, tab_mosaic,
            direction = c("v","h"), set_labels=list(Plurality.or.Multiple.Birth 
                                                    = c("1", "2",">3")),
            gp_labels = grid::gpar(fontsize = 8), highlighting_fill = c("#D1E5F0","#2166AC"),
            main = "Delivery Method vs. Multiple Birth Number")
  
```

### LMP weeks
```{r}
df_bar <- fetal_2 %>%
  dplyr::group_by(LMP.Gestational.Age.10) %>%
  dplyr::summarise(add = sum(Percent.of.Total.Deaths)) %>%
  dplyr::arrange(desc(add)) %>%
  na.omit()

ggplot(data = df_bar,aes(x = reorder(LMP.Gestational.Age.10,add), y=add)) +
  geom_bar(stat = "identity",fill = "cornflowerblue") +
  ggtitle("LMP Gestational Age Distribution") +
  xlab("LMP Gestational Age") +
  ylab("Percent to Total Death") +
  coord_flip() +
  theme(panel.grid.major.x = element_blank())
```



## Maternal/Paternal Characteristics

```{r}
library(tidyverse)
library(ggplot2)
parentsAge <- read.delim("parentsAge.txt") %>% 
  dplyr::select(Age.of.Mother.9, Age.of.Father,Fetal.Deaths) %>%
  dplyr::filter(Age.of.Father != "" & Age.of.Father != "Unknown or Not Stated" & Age.of.Father != "Not Reported")
g_age <- ggplot(parentsAge, aes(x = Age.of.Father, y = Fetal.Deaths)) +
  geom_col(position = "dodge") +
  coord_flip() + 
  facet_wrap(~Age.of.Mother.9) + 
  ggtitle("Fetal Deaths Faceted by Maternal Age") + 
  xlab("Paternal Age") +
  ylab("# of Fetal Deaths")
print(g_age)
```

```{r}
race <- fetal %>% dplyr::select(Mother.s.Bridged.Race, Year, Fetal.Deaths) %>%
  filter(Mother.s.Bridged.Race != "Not Reported") %>%
  group_by(Mother.s.Bridged.Race, Year) %>%
  summarize(n = n())

library(ggridges)
g_race <- ggplot(race, aes(x = Year, y = Mother.s.Bridged.Race, fill = Mother.s.Bridged.Race)) +
  geom_density_ridges(aes(n)) +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("")
print(g_race)
```





### Clevland plot

```{r}
library(dplyr)
library(ggplot2)
Race_N_Marriage <- read.delim("RaceNMarriage.txt") %>% 
  rename('Maternal_Race' = Mother.s.Bridged.Race) %>%
  rename('Maternal Marital Status' = Mother.s.Marital.Status) %>% 
  na.omit() %>%
  dplyr::select(`Maternal_Race`, `Maternal Marital Status`, Fetal.Deaths) %>%
  filter(`Maternal Marital Status` == "Married" | `Maternal Marital Status` == "Unmarried") %>%
  group_by(Maternal_Race,'Maternal Marital Status')

ggplot(Race_N_Marriage, aes(x = Maternal_Race, y = Fetal.Deaths, color = `Maternal Marital Status`)) +
  geom_point(size = 3) +
  coord_flip() +
#  facet_wrap(~Maternal Marital Status)+
  ylab("# of Fetal Deaths") +
  xlab("Maternal Race")
```

