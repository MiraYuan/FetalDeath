# Interactive component

## The Total Amount of Fetal Death from 2005 to 2019

```{r}
library(dygraphs)
library(xts)          
library(tidyverse)
library(lubridate)

#data
fetal_by_year <- fetal %>% group_by(Year) %>%
  summarize(`Total Fetal Deaths` = sum(Fetal.Deaths))

#plot
g_by_year <- dygraph(fetal_by_year) %>%
  dyOptions(labelsUTC = TRUE, fillGraph=TRUE, fillAlpha=0.1, drawGrid = FALSE, colors="#D8AE5A") %>%
  dyRangeSelector() %>%
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightCircleSize = 5, highlightSeriesBackgroundAlpha = 0.2, hideOnMouseOut = FALSE)  %>%
  dyRoller(rollPeriod = 1) 
g_by_year
```

## Percentage of Fetal Deaths by State
```{r}
library(plotly)
fetal_con_downs_new <- fetal_con_downs %>%
  group_by(Standard.Residence.States,Downs.Syndrome) %>%
  summarise(add = sum(Percent.of.Total.Deaths)) %>%
  filter(Downs.Syndrome=="Yes") %>%
  rename(State =Standard.Residence.States) %>%
  select(1,3)

not_include <- state.name[state.name %in% fetal_con_downs_new$State == FALSE]
bind <- data.frame(State =not_include,
                   add = rep(NA, length(not_include)))
fetal_con_downs_new <- rbind(fetal_con_downs_new, bind)

#pivot_wider(names_from = Downs.Syndrome, values_from = Percent.of.Total.Deaths)

## Trace only USA
g <- list(
  scope = 'usa',
  projection = list(type = 'albers usa'),
  lakecolor = toRGB('white')
)

percent <- fetal_con_downs_new$add
  
plot_geo() %>%
  add_trace(
    z = ~percent, text = state.name, span = I(1),
    locations = state.abb, locationmode = 'USA-states', colors = "Blues"
  ) %>%
  layout(geo = g)
```



## Changes in the Number of Fetal Deaths Among Different Maternal Ages in Different Years
```{r}
library(streamgraph)
library(tidyverse)

data <- fetal %>% group_by(Age.of.Mother.9, Year) %>% 
  summarise(Deaths = sum(Fetal.Deaths))
g_age_year <- streamgraph(data, key="Age.of.Mother.9", value="Deaths", date="Year") %>%
  sg_legend(show=TRUE, label="names: ")
g_age_year
```

